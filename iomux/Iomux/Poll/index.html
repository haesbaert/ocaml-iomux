<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Poll (iomux.Iomux.Poll)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">iomux</a> &#x00BB; <a href="../index.html">Iomux</a> &#x00BB; Poll</nav><header class="odoc-preamble"><h1>Module <code><span>Iomux.Poll</span></code></h1><p>A direct binding of poll(2).</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div><div class="spec-doc"><p>Main type for a poller.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span>?maxfds:int <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <a href="#type-t">t</a></span></code></div><div class="spec-doc"><p><code>create ?maxfds ()</code> creates a new poller.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">maxfds</span> <p>Maximum number of fds, defaults to <a href="../Util/index.html#val-max_open_files"><code>Util.max_open_files</code></a>.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-maxfds"><a href="#val-maxfds" class="anchor"></a><code><span><span class="keyword">val</span> maxfds : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>maxfds t</code> is the maximum number of file descriptor slots allocated for <code>t</code>.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Flags"><a href="#module-Flags" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Flags/index.html">Flags</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The set of flags associated with a file descriptor event.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-invalid_fd"><a href="#val-invalid_fd" class="anchor"></a><code><span><span class="keyword">val</span> invalid_fd : <span class="xref-unresolved">Unix</span>.file_descr</span></code></div><div class="spec-doc"><p><code>invalid_fd</code> is the <code>Unix</code>.file_descr of value -1.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-poll_timeout"><a href="#type-poll_timeout" class="anchor"></a><code><span><span class="keyword">type</span> poll_timeout</span><span> = </span></code><ol><li id="type-poll_timeout.Infinite" class="def variant constructor anchored"><a href="#type-poll_timeout.Infinite" class="anchor"></a><code><span>| </span><span><span class="constructor">Infinite</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>No timeout, wait forever</p><span class="comment-delim">*)</span></div></li><li id="type-poll_timeout.Nowait" class="def variant constructor anchored"><a href="#type-poll_timeout.Nowait" class="anchor"></a><code><span>| </span><span><span class="constructor">Nowait</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Don't block, return immediately</p><span class="comment-delim">*)</span></div></li><li id="type-poll_timeout.Milliseconds" class="def variant constructor anchored"><a href="#type-poll_timeout.Milliseconds" class="anchor"></a><code><span>| </span><span><span class="constructor">Milliseconds</span> <span class="keyword">of</span> int</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Block for at most <code>int</code> milliseconds</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>The timeout parameter for <a href="#val-poll"><code>poll</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-poll"><a href="#val-poll" class="anchor"></a><code><span><span class="keyword">val</span> poll : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-poll_timeout">poll_timeout</a> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>The actual poll(2) call</p><p><code>poll t nfds timeout</code> polls for the first <code>nfds</code>, like the system call, invalid (-1) entries are ignored. The internal buffer is not modified after the call. It returns the number of ready file descriptors suitable to be used with <a href="#val-iter_ready"><code>iter_ready</code></a>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-ppoll_timeout"><a href="#type-ppoll_timeout" class="anchor"></a><code><span><span class="keyword">type</span> ppoll_timeout</span><span> = </span></code><ol><li id="type-ppoll_timeout.Infinite" class="def variant constructor anchored"><a href="#type-ppoll_timeout.Infinite" class="anchor"></a><code><span>| </span><span><span class="constructor">Infinite</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>No timeout, wait forever</p><span class="comment-delim">*)</span></div></li><li id="type-ppoll_timeout.Nowait" class="def variant constructor anchored"><a href="#type-ppoll_timeout.Nowait" class="anchor"></a><code><span>| </span><span><span class="constructor">Nowait</span></span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Don't block, return immediately</p><span class="comment-delim">*)</span></div></li><li id="type-ppoll_timeout.Nanoseconds" class="def variant constructor anchored"><a href="#type-ppoll_timeout.Nanoseconds" class="anchor"></a><code><span>| </span><span><span class="constructor">Nanoseconds</span> <span class="keyword">of</span> int64</span></code><div class="def-doc"><span class="comment-delim">(*</span><p>Block for at most <code>int64</code> nanoseconds</p><span class="comment-delim">*)</span></div></li></ol></div><div class="spec-doc"><p>The timeout parameter for <a href="#val-ppoll"><code>ppoll</code></a>. Supports nanoseconds instead of milliseconds.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ppoll"><a href="#val-ppoll" class="anchor"></a><code><span><span class="keyword">val</span> ppoll : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-ppoll_timeout">ppoll_timeout</a> <span class="arrow">&#45;&gt;</span></span> <span><span>int list</span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>The actual ppoll(2) call</p><p><code>ppoll t nfds timeout sigmask</code> is like <a href="#val-poll"><code>poll</code></a> but supports nanoseconds and a list of signals that are atomically masked during execution and restored uppon return.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_index"><a href="#val-set_index" class="anchor"></a><code><span><span class="keyword">val</span> set_index : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span> <span><a href="Flags/index.html#type-t">Flags.t</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_index t index fd flag</code> modifies the internal buffer at <code>index</code> to listen to <code>flag</code> events of <code>fd</code>. This overwrites any previous value of <code>flag</code> and <code>fd</code> internally. <a href="#val-invalid_fd"><code>invalid_fd</code></a> (-1) can be used to deactivate the slot, but usage of <a href="#val-invalidate_index"><code>invalidate_index</code></a> is preferred.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-invalidate_index"><a href="#val-invalidate_index" class="anchor"></a><code><span><span class="keyword">val</span> invalidate_index : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>invalidate_index t index</code> modifies the internal buffer by invalidating <code>index</code>. The kernel will ignore that slot. We also clear flags, just for kicks.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_revents"><a href="#val-get_revents" class="anchor"></a><code><span><span class="keyword">val</span> get_revents : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <a href="Flags/index.html#type-t">Flags.t</a></span></code></div><div class="spec-doc"><p><code>get_revents t index</code> is the returned event flags set after a call to <a href="#val-poll"><code>poll</code></a> or <a href="#val-ppoll"><code>ppoll</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_fd"><a href="#val-get_fd" class="anchor"></a><code><span><span class="keyword">val</span> get_fd : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Unix</span>.file_descr</span></code></div><div class="spec-doc"><p><code>get_fd t index</code> is the file descriptor associated with <code>index</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iter_ready"><a href="#val-iter_ready" class="anchor"></a><code><span><span class="keyword">val</span> iter_ready : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Unix</span>.file_descr <span class="arrow">&#45;&gt;</span></span> <span><a href="Flags/index.html#type-t">Flags.t</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>iter_ready t nready fn</code> scans the internal buffer for every ready file descriptor and calls <code>fn index fd flags</code>, the scanning is aborted after <code>nready</code> entries are found. Invalid file descriptors (set to -1 via invalidate_index) are skipped. Typical usage is that <code>nready</code> is the return of <a href="#val-poll"><code>poll</code></a> or <a href="#val-ppoll"><code>ppoll</code></a>. The internal buffer is left unmodified.</p></div></div></div></body></html>